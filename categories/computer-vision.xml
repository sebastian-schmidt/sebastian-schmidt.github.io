<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/"><channel><title>actin.io (computer vision)</title><link>http://actin.io/</link><description></description><atom:link href="http://actin.io/categories/computer-vision.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><lastBuildDate>Sat, 02 May 2015 11:48:41 GMT</lastBuildDate><generator>http://getnikola.com/</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Line width detection in Matlab</title><link>http://actin.io/posts/line-width-detection-in-matlab.html</link><dc:creator>Sebastian Schmidt</dc:creator><description>&lt;div&gt;&lt;p&gt;We wanted a simple line width estimation for a recent project. It was
meant  to analyze the width of actin bundles. After some searching for
an existing solution to the problem I only found &lt;a class="reference external" href="http://www.ncbi.nlm.nih.gov/pubmed/17269626"&gt;this paper&lt;/a&gt;.
Usually I try to use existing programs in Matlab. It is very
common for physicists to reinvent the wheel.&lt;/p&gt;
&lt;p&gt;I prepared a few images to show how the Matlab script works. I used two different line sizes for a gaussian type brush and 4 different widths for the hard edge pen tool. It should be fairly customizable to diffent approaches.&lt;/p&gt;
&lt;div class="figure align-center"&gt;
&lt;img alt="Different strokes" src="http://actin.io/images/lineswidth/lines_size20.png"&gt;&lt;p class="caption"&gt;Differently oriented lines with brush size 20&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;I want to check different orientations. All theses lines should be the same size.&lt;/p&gt;
&lt;blockquote&gt;
It should be mentioned that these drawn examples are pretty perfect
compared to usual use cases. Commonly there would be filter applied
to the image like gaussian blur, maybe background removal. Another
important part is the adjustment of intensity if they differ between
images.&lt;/blockquote&gt;
&lt;p&gt;The main trick of this image analysis is the &lt;a class="reference external" href="http://en.wikipedia.org/wiki/Radon_transform"&gt;Radon transform&lt;/a&gt;. It
Creates radial projections along different angles. The same principles
are used in computer tomography to
calculate composite 3D visualizations from 2D images take from different angles.&lt;/p&gt;
&lt;p&gt;The most prominent peaks in the Radon transform are for the angles of
the lines in an image. For that angle we look at the profile and fit a
gaussian to measure the width. That is basically all we need. The rest
of the script are a few extras to make it easier to input images.&lt;/p&gt;
&lt;p&gt;Lets look plot of the Radon transform of the first image:&lt;/p&gt;
&lt;pre class="code Matlab"&gt;&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-1"&gt;&lt;/a&gt;&lt;span class="k"&gt;function&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;f &lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;linewidthofimage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;imagepath&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-2"&gt;&lt;/a&gt;&lt;span class="n"&gt;bundleImage&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="n"&gt;imread&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;imagepath&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-3"&gt;&lt;/a&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-4"&gt;&lt;/a&gt;&lt;span class="c"&gt;% convert to greyscale if necessary&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-5"&gt;&lt;/a&gt;&lt;span class="k"&gt;if&lt;/span&gt;  &lt;span class="nb"&gt;size&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bundleImage&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-6"&gt;&lt;/a&gt;    &lt;span class="n"&gt;bundleImage&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;rgb2gray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bundleImage&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-7"&gt;&lt;/a&gt;&lt;span class="k"&gt;end&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-8"&gt;&lt;/a&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-9"&gt;&lt;/a&gt;&lt;span class="c"&gt;%crop&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-10"&gt;&lt;/a&gt;&lt;span class="c"&gt;% if ~exist('cropRect')&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-11"&gt;&lt;/a&gt;&lt;span class="c"&gt;%     cropRect=[10,10,size(bundleImage,2)-20,size(bundleImage,1)-20];&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-12"&gt;&lt;/a&gt;&lt;span class="c"&gt;% end;&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-13"&gt;&lt;/a&gt;&lt;span class="c"&gt;% f=figure;&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-14"&gt;&lt;/a&gt;&lt;span class="c"&gt;%&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-15"&gt;&lt;/a&gt;&lt;span class="c"&gt;% imshow(bundleImage,'Border','tight');&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-16"&gt;&lt;/a&gt;&lt;span class="c"&gt;% set(gcf, 'units','normalized','outerposition',[0 0 1 1]);&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-17"&gt;&lt;/a&gt;&lt;span class="c"&gt;% h=imrect(gca,cropRect)&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-18"&gt;&lt;/a&gt;&lt;span class="c"&gt;% cropRect = wait(h);&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-19"&gt;&lt;/a&gt;&lt;span class="c"&gt;% [bundleImage]=imcrop(bundleImage,cropRect);&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-20"&gt;&lt;/a&gt;&lt;span class="c"&gt;% close(f)&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-21"&gt;&lt;/a&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-22"&gt;&lt;/a&gt;&lt;span class="n"&gt;myfigure&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="n"&gt;figure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'Name'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;imagepath&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;'NumberTitle'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;'off'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-23"&gt;&lt;/a&gt;&lt;span class="n"&gt;bundleForPeakFinding&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="n"&gt;bundleImage&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-24"&gt;&lt;/a&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-25"&gt;&lt;/a&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bundleImage&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-26"&gt;&lt;/a&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-27"&gt;&lt;/a&gt;&lt;span class="n"&gt;iptsetpref&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'ImshowAxesVisible'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;'on'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-28"&gt;&lt;/a&gt;&lt;span class="n"&gt;theta&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;179&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-29"&gt;&lt;/a&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;xp&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;radon&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bundleForPeakFinding&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;theta&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-30"&gt;&lt;/a&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-31"&gt;&lt;/a&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="p"&gt;,[],&lt;/span&gt;&lt;span class="s"&gt;'Xdata'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;theta&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;'Ydata'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;xp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;'InitialMagnification'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;'fit'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-32"&gt;&lt;/a&gt;&lt;span class="n"&gt;xlabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'\theta (degrees)'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-33"&gt;&lt;/a&gt;&lt;span class="n"&gt;ylabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'x'''&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-34"&gt;&lt;/a&gt;&lt;span class="n"&gt;colormap&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;hot&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;colorbar&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-35"&gt;&lt;/a&gt;&lt;span class="n"&gt;axis&lt;/span&gt; &lt;span class="n"&gt;normal&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-36"&gt;&lt;/a&gt;&lt;span class="n"&gt;iptsetpref&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'ImshowAxesVisible'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;'off'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-37"&gt;&lt;/a&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-38"&gt;&lt;/a&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="n"&gt;peakfit2d&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-39"&gt;&lt;/a&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;round&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-40"&gt;&lt;/a&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-41"&gt;&lt;/a&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="n"&gt;imagesc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="n"&gt;hold&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-42"&gt;&lt;/a&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="s"&gt;'r+'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-43"&gt;&lt;/a&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;xp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="p"&gt;(:,&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)));&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-44"&gt;&lt;/a&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'R_{0^o} (x\prime)'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-45"&gt;&lt;/a&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-46"&gt;&lt;/a&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;xp&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;radon&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bundleImage&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-47"&gt;&lt;/a&gt;&lt;span class="n"&gt;width1&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="n"&gt;fwhm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;xp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-48"&gt;&lt;/a&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-49"&gt;&lt;/a&gt;&lt;span class="n"&gt;stringout&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="n"&gt;sprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'Width:%0.2f'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;width1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-50"&gt;&lt;/a&gt;&lt;span class="nb"&gt;disp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;stringout&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-51"&gt;&lt;/a&gt;
&lt;a name="rest_code_7da5ac9e42a34b13983907a58a5ef2f8-52"&gt;&lt;/a&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;width1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;Two external function were used:&lt;/p&gt;
&lt;ul class="simple"&gt;&lt;li&gt;&lt;a class="reference external" href="http://www.mathworks.com/matlabcentral/fileexchange/10590-fwhm"&gt;fwhm&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://www.mathworks.com/matlabcentral/fileexchange/26504-sub-sample-peak-fitting-2d/content/peakfit2d.m"&gt;peakfit2d&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;You can see 4 peaks corresponding to the 4 strokes (or five because one
is going over from 0 to 180 degree). One peak is right
over the borders at 0 and 179 degree. Another one is visible at 90
degree. These two are the vertical one and horizontal one.&lt;/p&gt;
&lt;div class="figure align-center"&gt;
&lt;img alt="Matlab output" src="http://actin.io/images/lineswidth/output4lines.png"&gt;&lt;p class="caption"&gt;Matlab plot of Radon transform&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;In the upper left we see the input image. In the upper right is the plotted radon transform from 0 to 179 degrees.
In the lower left, we have a little plus plotted into the most prominent peak.
This is the one that will be used. In the lower right, we have the slice of the
transform for the angle marked by the +. Now we can use the half width full maximum as a
measure of width for our &lt;em&gt;brush&lt;/em&gt; size.&lt;/p&gt;
&lt;p&gt;Now we can put everything together and write a function that takes a
path to an image file that has exactly one major line and gives the
width of it as the result.&lt;/p&gt;
&lt;pre class="code Matlab"&gt;&lt;a name="rest_code_535e35681e70487983828f06d27e2855-1"&gt;&lt;/a&gt;&lt;span class="n"&gt;close&lt;/span&gt; &lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-2"&gt;&lt;/a&gt;&lt;span class="n"&gt;clear&lt;/span&gt; &lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-3"&gt;&lt;/a&gt;&lt;span class="n"&gt;nFilesToLookAt&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c"&gt;% 0 for all&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-4"&gt;&lt;/a&gt;&lt;span class="n"&gt;folder_name&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;uigetdir&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-5"&gt;&lt;/a&gt;&lt;span class="c"&gt;% Get list of all *.png files in this directory&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-6"&gt;&lt;/a&gt;&lt;span class="c"&gt;% DIR returns as a structure array.  You will need to use () and . to get&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-7"&gt;&lt;/a&gt;&lt;span class="c"&gt;% the file names.&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-8"&gt;&lt;/a&gt;&lt;span class="n"&gt;imagefiles&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dir&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fullfile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;folder_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;'/*.png'&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-9"&gt;&lt;/a&gt;&lt;span class="n"&gt;nfiles&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;length&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;imagefiles&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-10"&gt;&lt;/a&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;nFilesToLookAt&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-11"&gt;&lt;/a&gt;    &lt;span class="n"&gt;nFilesToLookAt&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="n"&gt;nfiles&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-12"&gt;&lt;/a&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-13"&gt;&lt;/a&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-14"&gt;&lt;/a&gt;&lt;span class="n"&gt;AllWidths&lt;/span&gt;&lt;span class="p"&gt;=[];&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-15"&gt;&lt;/a&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nb"&gt;i&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nb"&gt;round&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nfiles&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;nFilesToLookAt&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;span class="n"&gt;nfiles&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-16"&gt;&lt;/a&gt;    &lt;span class="n"&gt;currentfilename&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fullfile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;folder_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;imagefiles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;i&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-17"&gt;&lt;/a&gt;    &lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="n"&gt;linewidthofimages&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;currentfilename&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-18"&gt;&lt;/a&gt;    &lt;span class="n"&gt;AllWidths&lt;/span&gt;&lt;span class="p"&gt;=[&lt;/span&gt;&lt;span class="n"&gt;AllWidths&lt;/span&gt; &lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-19"&gt;&lt;/a&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-20"&gt;&lt;/a&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-21"&gt;&lt;/a&gt;&lt;span class="n"&gt;figure&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-22"&gt;&lt;/a&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;AllWidths&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-23"&gt;&lt;/a&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-24"&gt;&lt;/a&gt;&lt;span class="nb"&gt;disp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'mean width:%0.2f'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;AllWidths&lt;/span&gt;&lt;span class="p"&gt;)));&lt;/span&gt;
&lt;a name="rest_code_535e35681e70487983828f06d27e2855-25"&gt;&lt;/a&gt;&lt;span class="nb"&gt;disp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'median width:%0.2f'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;median&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;AllWidths&lt;/span&gt;&lt;span class="p"&gt;)));&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;This procedure queries a folder name and calculates the
widths of all images inside. Afterwards it plots the resulting widths.
I created a folder with single images of these lines:&lt;/p&gt;
&lt;div class="figure align-center"&gt;
&lt;img alt="Matlab output" src="http://actin.io/images/lineswidth/lines_pen.png"&gt;&lt;p class="caption"&gt;different sizes&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;And this was the output:&lt;/p&gt;
&lt;div class="figure align-center"&gt;
&lt;img alt="Matlab output" src="http://actin.io/images/lineswidth/pens.png"&gt;&lt;p class="caption"&gt;different sizes&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;This can be useful if you have a image series with timestamps
and want to see if the object get wider.&lt;/p&gt;
&lt;p&gt;And that is all to it. Possible changes include opening a GUI to
specifically select a line (currently commented out). One can also
detect several peaks at one which is provided with the used peak
finding function.&lt;/p&gt;&lt;/div&gt;</description><category>computer vision</category><category>matlab</category><guid>http://actin.io/posts/line-width-detection-in-matlab.html</guid><pubDate>Tue, 28 Apr 2015 19:23:54 GMT</pubDate></item></channel></rss>